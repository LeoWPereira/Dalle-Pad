%===============================================================
% Universidade Tecnológica Federal do Paraná
% Departamento Acadêmico de Eletrônica
% Departamento Acadêmico de Informática
% Engenharia de Computação
% Oficina de Integração 3 (IF66J)
% Modelo e instruções para a elaboração dos
% relatórios técnicos da disciplina IF66J
% Autores: Gustavo B. Borba e Guilherme A. Schneider
% Versão: 27.fev.2016
%===============================================================

% Preâmbulo

% http://easylatek.blogs.sapo.pt/3034.html [---
\documentclass[a4paper,11pt]{article}
\usepackage[portuguese]{babel}
% Para Windows
\usepackage[latin1]{inputenc} %substituir 'latin1' por 'utf8' para editores ShareLaTex ou Overleaf
\usepackage[T1]{fontenc}
% Para Linux
% \usepackage[utf8]{inputenc}
% Para Mac
% \usepackage[applemac]{inputenc}
% ---]
% Packages [---
\usepackage{fancyhdr} %para copeçalho e rodapé
\usepackage{fancybox} %para copeçalho e rodapé
\pagestyle{fancy} %para copeçalho e rodapé
\usepackage{easylist} %para aninhar enumerate
\usepackage{paralist} %para compactenum
\usepackage{pbox} %para parbox
\usepackage[hyphens]{url}  %para url com line break
\usepackage{multirow} %para multirow e multicolumn
\usepackage{array, hhline} %mais opcoes para o ambiente tabular
\usepackage{fourier} %symbols
\usepackage{ifsym} %symbols
\usepackage{graphicx} %para inserir jpg e png e pdf
\usepackage{array} % para poder utilizar comprimentos pré-definidos em uma tabela
\usepackage{xcolor,colortbl} % para poder utilizar cores em uma tabela
\usepackage{booktabs, tabularx, ltablex, longtable, supertabular} % para poder usar tabelas em múltiplas páginas
\usepackage{multirow} % para poder usar Linhas e Colunas multiplas em tabelas
\usepackage{float} % para controlar a posição de figuras no documento
\usepackage{eurosym} % para o símbolo do euro
\usepackage{caption, subcaption} % para figuras / subfiguras
% ---]

% Cria hyperlinks e estrutura de tópicos para navegar em um pdf reader [---
% Não alterar
\usepackage[pdftex]{hyperref}
\usepackage{color}
\definecolor{corlinkprint}{rgb}{0, 0, 0}
\hypersetup{
  colorlinks,
  citecolor   = corlinkprint,
  filecolor   = corlinkprint,
  linkcolor   = corlinkprint,
  urlcolor    = corlinkprint}
% ---]

% Cabeçalho e rodapé a partir da página 2 [---
% Substituir 'Modelo' pelo nome do projeto (nome de uma palavra usado na disciplina)
\fancyhead[L]{\small{Relatório Técnico: Dalle Pad - O \textit{gadget} que te transforma em um DJ}}
\fancyhead[R]{\small\thepage}
\fancyfoot{}
\renewcommand\headrulewidth{0.4pt}
% ---]

% Título [---
% Substituir 'Modelo...' pelo título do relatório
\title{
Relatório Técnico\\
\textbf{Dalle Pad - O \textit{gadget} que te transforma em um DJ}}
% ---]

% Autores [---
% Substituir pelos nomes e emails dos integrantes
\author{
Leonardo W. Pereira \footnotesize{-- leonardowinterpereira@gmail.com}\\
Lucas Z. Cordeiro \footnotesize{-- lukeszc@gmail.com}\\
Luis Felipe. M. Ortiz \footnotesize{-- luisfmazzu@gmail.com}\\
}
% ---]

% Substituir pelo mes e ano da defesa [---
\date{Junho de 2016}
% ---]

\begin{document}

\definecolor{darkRed}{rgb}{0.3, 0.3, 0.3}
\definecolor{lightRed}{rgb}{0.674509803922, 0.674509803922, 0.674509803922}

\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

% Cabeçalho da página 1 [---
% Não alterar
\thisfancyput(35mm,-10mm){
\begin{tabular}{c}
Universidade Tecnológica Federal do Paraná -- \small{UTFPR}\\
Departamento Acadêmico de Eletrônica -- \small{DAELN}\\
Departamento Acadêmico de Informática -- \small{DAINF}\\
Engenharia de Computação\\
Oficina de Integração 3 (IF66J) -- S71 -- 2016/1 \\
\\
\hline
\end{tabular}}
% ---]

% Insere título, autores e data [---
\maketitle
% ---]

% Resumo [---

\begin{abstract}

    O trabalho consiste no desenvolvimento de um equipamento musical eletrônico. Atualmente com a evolução da área musical é possível gerar sons artificiais e criar músicas a partir deste tipo de equipamento. Portanto, há a necessidade de desenvolver novas tecnologias para a produção musical, para contemplar o que já é produzido atualmente e o que surgirá no futuro. Os componentes utilizados nesse projeto são de baixo custo, consistindo em um invólucro de madeira, botões, potenciômetros, um microcontrolador, módulo \textit{Bluetooth} e um shield MIDI. As principais funções do projeto são enviar mensagens MIDI, de maneira que qualquer \textit{software} possa reconhecê-los, e desenvolver um aplicativo para Android que reproduz áudio ao receber essas mensagens. Como resultado, tem-se uma estrutura que apresenta todas as funcionalidades básicas para um músico editar e tocar músicas da maneira que desejar.

\end{abstract}
% ---]

%===============================================================
% Corpo do texto [---
% Substituir pelo seu relatório

\section{Introdução}
\label{sec:introducao}

    A música é a arte de combinar sons de maneira agradável ao ouvido e a sensibilidade emocional utilizando elementos como melodia, harmonia e ritmo. Atualmente, não se conhece nenhuma civilização ou agrupamento que não possua manifestações musicais próprias. A criação, o desempenho, o significado e até mesmo a definição de música variam de acordo com a cultura e o contexto social, como composições fortemente organizadas e improvisadas~\cite{SANTINI2005}.

    Os instrumentos musicais até o século XIX baseavam-se em um mesmo princípio de produção sonora, todo som era proveniente da vibração de algum material elástico (as cordas do violão e do piano, por exemplo) que gerava ondas que se propagam pelo ar até atingirem o sistema auditivo do ouvinte. Entretanto, o surgimento de novas tecnologias baseadas na eletricidade e no uso de sinais eletromagnéticos abriu a possibilidade da geração de sons artificiais, sem a utilização de instrumentos mecânicos~\cite{ArtistsHouseMusic}~\cite{Hewitt}.

    Atualmente, pode-se contar com a Tecnologia MIDI. Desde seu lançamento no mercado no inicio da década de 1980, o protocolo MIDI tem tido um papel de grande importância na indústria da música. MIDI permitiu, pela primeira vez, um meio de comunicação de informações musicais de um dispositivo para outro de uma forma que foi aceito e adotado por toda uma indústria~\cite{Guerin}. Este protocolo continua sendo amplamente utilizado na área musical, e é de interesse deste projeto compreender a teoria e a prática referente a este tipo de aplicação, não somente sua utilização no produto final. Esta é a motivação para o desenvolvimento do controlador DALLE PAD.

    \begin{figure}[H]
    	\centering
    	\includegraphics[scale=0.11]{Imagens/imagem-geral.png}
    	\caption[Visão Geral do projeto]{Visão Geral do projeto}
    	\label{fig:imagem-geral}
    \end{figure}

    O trabalho consiste em desenvolver um controlador MIDI que funciona transmitindo informações tanto via interface MIDI, para se comunicar com qualquer \textit{software} que possua esta comunicação, quanto via \textit{bluetooth}, para se comunicar com um aplicativo para o sistema operacional Android desenvolvido pela equipe. Como pode ser visto na Figura~\ref{fig:imagem-geral}, esta comunicação é feita a partir de um sistema embarcado Arduino Mega, que recebe informações vindas de botões e potenciômetros e as converte em mensagens seriais a serem transmitidas pelos seus pinos de Tx/Rx. No \textit{software} para Android, sons pré definidos disponíveis no aplicativo podem ser relacionados com cada botão, que ao ser pressionado, envia esta informação para o celular que reproduz o áudio. Na comunicação via interface MIDI, cada botão pressionado envia uma mensagem informando qual botão está se comunicando, e os potenciômetros enviam seu valor para as entradas analógicas do Arduino. Com isso, estes \textit{softwares} são capazes de mapear quaisquer funções disponíveis ao DallePad, permitindo que ele funcione como instrumento para remixagens, criação de conteúdo musical novo, efeitos sonoros e performance ao vivo.

    No desenvolvimento do projeto, alguns requisitos, que servem de guia para todas as modificações e aperfeiçoamentos, foram levantados. Tais requisitos estão definidos nas Tabelas \ref{table:requisitos-funcionais} e \ref{table:requisitos-nao-funcionais}.

    \begin{center}
        \tablefirsthead{%
          \hline
          \rowcolor{darkRed} \textcolor{white}{\textbf{Requisitos Funcionais}} \\
          \hline}
        \tablehead{%
          \hline
          \multicolumn{1}{|l|}{\small\sl continuação da página anterior} \\
          \hline
          \rowcolor{darkRed} \textcolor{white}{\textbf{Requisitos Funcionais}} \\
          \hline}
        \tabletail{%
          \hline
          \multicolumn{1}{|r|}{\small\sl continua na próxima página} \\
          \hline}
        \tablelasttail{\hline}
        \bottomcaption{Requisitos Funcionais do projeto
        \label{table:requisitos-funcionais}}
        %
        \begin{supertabular}{| C{12.3cm} |}
            \rowcolor{lightRed} O \textit{software} deverá permitir ao usuário final controlar dados MIDI \\
            \rowcolor{white}    O \textit{software} deverá permitir que o usuário altere as configurações do Dalle Pad \\
            \rowcolor{lightRed} O \textit{software} deverá realizar funções básicas, como trocar efeitos e tocá-los \\
            \rowcolor{white} O \textit{hardware} deverá possibilitar uma fácil interação do usuário com o \textit{software} através de botões e potenciômetros \\
            \rowcolor{lightRed} O \textit{hardware} deverá realizar uma ação ao ser pressionado um botão ou modificado um potênciometro \\
        \end{supertabular}
    \end{center}

    \begin{center}
        \tablefirsthead{%
          \hline
          \rowcolor{darkRed} \textcolor{white}{\textbf{Requisitos Não-Funcionais}} \\
          \hline}
        \tablehead{%
          \hline
          \multicolumn{1}{|l|}{\small\sl continuação da página anterior} \\
          \hline
          \rowcolor{darkRed} \textcolor{white}{\textbf{Requisitos Não-Funcionais}} \\
          \hline}
        \tabletail{%
          \hline
          \multicolumn{1}{|r|}{\small\sl continua na próxima página} \\
          \hline}
        \tablelasttail{\hline}
        \bottomcaption{Requisitos Não-Funcionais do projeto
        \label{table:requisitos-nao-funcionais}}
        %
        \begin{supertabular}{| C{12.3cm} |}
            \rowcolor{lightRed} O projeto deverá possuir um relatório técnico \\
            \rowcolor{white}    O \textit{hardware} deverá possuir PCB's para facilitar o interfaceamento e evitar o acúmulo de fios \\
            \rowcolor{lightRed} O aplicativo deverá possuir uma Interface gráfica funcional (em um estado inicial deve ser necessário ao menos a edição de som para cada botão, efeitos e volume, bem como uma interface simples de aprendizado) \\
            \rowcolor{white}    O projeto deverá apresentar conexão entre ambas as partes através de USB, MIDI e \textit{Bluetooth} \\
            \rowcolor{lightRed} O invólucro deverá ser de plástico (para que possa ser impresso em uma impressora 3D) ou de um material que possa ser desenvolvido pela equipe \\
            \rowcolor{white}    O \textit{software} deverá ser desenvolvido na plataforma Android \\
        \end{supertabular}
    \end{center}

    Ao longo do desenvolvimento do projeto, o problema que se procura resolver é: Existe como confeccionar um controlador MIDI que utilize os requisitos citados e que possua custo acessível?

\section{Fundamentação Teórica}
\label{sec:fundamentacao}

    Robert Guérin, autor do livro \textit{MIDI Power!} define MIDI como:  interface que permite que músicos, engenheiros de som e iluminação, entusiastas da computação, ou qualquer outra pessoa que utilize computadores e instrumentos musicais eletrônicos para criar, ouvir e aprender sobre música, oferecendo uma linguagem comum entre dispositivos e \textit{software} compatíveis.{~\cite{Guerin}}

    Com esta definição, pode-se perceber que MIDI é, por si só, incapaz de reproduzir som. Seus dados podem ser gravados em um programa de \textit{software} (conhecido como sequênciador) ou dispositivo de \textit{hardware}, onde estes podem ser editados e transmitidos para instrumentos eletrônicos ou outros dispositivos para criar a música ou controlar qualquer parâmetro desejado. Além disso, MIDI pode ser separado em três entidades diferentes: a) A linguagem utilizada, também conhecida como protocolo de comunicação; b) a interface de \textit{hardware} utilizada para transmitir e receber essas informações (tais como conectores e cabos); c) os formatos de distribuição, tal como SMF (\textit{Standard MIDI Files}).

    Fundamentalmente, MIDI é uma linguagem de descrição de música em forma binária, em que cada palavra binária descreve um evento de uma música~\cite{Alves}. Cada instrumento musical realiza um som, o qual está totalmente sobre controle do músico. A mensagem MIDI em si não contém o real som tocado pelo instrumento, mas sim a ação de tocar uma determinada nota em um determinado momento e durante um determinado período~\cite{Gibson2013}~\cite{Hass}.

    O protocolo de comunicação MIDI é transmitido de forma serial ao invés de paralela. Em uma transmissão paralela, como o nome sugere, as informações são transmitidas simultaneamente. A quantidade de dados que podem ser transmitidos simultaneamente depende na capacidade física do fio e da velocidade com que os dispositivos podem enviar suas informações. Na Figura ~\ref{fig:Parallel_versus_serial_transmissions}, podemos perceber que um \textit{byte} (oito \textit{bits}) é transmitido simultaneamente utilizando uma transmissão paralela. A transmissão serial, por outro lado, consegue enviar apenas um \textit{bit} após o outro.

    \begin{figure}[H]
    	\centering
    	\includegraphics[scale=0.5]{Imagens/Parallel_versus_serial_transmissions.png}
    	\caption[Comparação entre transmissão serial e paralela]{Comparação entre transmissão serial e paralela}
    	\label{fig:Parallel_versus_serial_transmissions}
    \end{figure}

    MIDI envia informação a uma taxa de 31250 bps (\textit{bits} por segundo). Essa velocidade é chamada de taxa de transmissão. Uma vez que o protocolo utiliza transmissão serial, o mesmo envia apenas um \textit{bit} por vez. Cada \textit{byte} em uma mensagem MIDI contém 10 \textit{bits} de dados (8 \textit{bits} para as informações e 2 \textit{bits} para correção de erro). Isso significa que MIDI envia cerca de 3125 \textit{bytes} de dados cada segundo.

    Quando comparamos esse valor com a taxa de transmissão de 176400 \textit{bytes} necessária para transmitir áudio digital (reprodução e gravação) em formado de CD de áudio, MIDI pode parecer incrivelmente devagar. Entretanto, neste último não é necessário enviar tanta informação quanto o áudio digital, sendo capaz de, teoricamente, transmitir até 500 mensagens MIDI por segundo.

    MIDI tem a vantagem de ser compacto, uma vez que o som tocado por determinado instrumento não é gravado, mas sim apenas as informações de cada evento. Devido a este fato, arquivos MIDI apresentam um tamanho cerca de 300 vezes menor do que um arquivo de música atual (MP3). Entretanto, esse valor pode ser muito maior se compararmos com formatos descompactados de músicas.

    O fato de MIDI não gravar som, entretanto, pode também ser uma desvantagem. Quando o som de um determinado instrumento é gravado, o usuário tem total controle sobre o resultado final, enquanto com MIDI, este mesmo resultado depende do dispositivo ou \textit{software} que será utilizado para reproduzir este mesmo som~\cite{Ballou}.

    Quando se trabalha com música, muitas vezes deseja-se que diversos instrumentos participem da mesma composição. Com MIDI, pode-se incluir instruções para cada um deles através dos chamados \textbf{canais MIDI}. Um canal MIDI pode ser visto como um canal de televisão (veja a Figura ~\ref{fig:midi-channels}). Um determinado instrumento conecta-se apenas a um único canal, assim como um usuário o faz em sua televisão. Isso não significa que os outros canais não estão disponíveis, mas sim que o conteúdo disponível (no nosso caso, a mensagem MIDI) foi filtrado para processar apenas o relevante para aquele canal.

    \begin{figure}[H]
    	\centering
    	\includegraphics[scale=0.4]{Imagens/midi-channels.png}
    	\caption[Exemplo de canais MIDI]{Exemplo de canais MIDI ~\cite{Gibson2013}}
    	\label{fig:midi-channels}
    \end{figure}

    Cada porta MIDI suporta até 16 canais simultâneos. Em outras palavras, um usuário pode escolher um determinado canal para transmitir as mensagens MIDI ou possuir até 16 instrumentos conectados simultaneamente, cada um realizando diferentes eventos.

    Para transmitir informações através de dispositivos, é utilizado uma \textbf{mensagem MIDI}. O conteúdo de uma mensagem MIDI apresenta um componente chamado de \textit{status byte}. Este componente é acompanhado por um valor que é definido por um ou mais \textit{bytes} de dados, como pode ser visto na Figura~\ref{fig:Status_and_Data_Bytes}.

    \begin{figure}[H]
    	\centering
    	\includegraphics[scale=0.5]{Imagens/Status_and_Data_Bytes.jpg}
    	\caption[Byte de estado e de dados]{Byte de estado e de dados ~\cite{Guerin}}
    	\label{fig:Status_and_Data_Bytes}
    \end{figure}

    \begin{itemize}
        \item A porção referente ao \textit{byte} de estado serve para identificar o tipo de informação que está sendo enviada. Ela informa ao dispositivo receptor a qual canal MIDI determinado evento pertence e o que este evento é.

        \item A porção referente ao \textit{byte} de dados informa ao dispositivo receptor o valor que está associado ao evento determinado na outra porção da mensagem MIDI.
    \end{itemize}

    Os valores utilizados pelo \textit{byte} de estado variam entre 128 e 255 (1000 0000 a 1111 1111 em números binários), enquanto para o \textit{byte} de dados estes variam entre 0 a 127 (0000 0000 a 0111 1111 em números binários). É fácil perceber que, para um dispositivo MIDI reconhecer qual o tipo de mensagem que se está sendo transmitida, basta verificar o MSB (Most Significant Bit) (\textit{Bit} mais significativo, do inglês). Se este valor for 1, trata-se de um \textit{byte} de estado e, caso contrário, de um \textit{byte} de dados.

    Digamos que um dispositivo MIDI receba três valores: 175, 43 e 125. Ele saberá que 175 é um \textit{byte} de estado, enquanto os outros dois valores são os \textit{bytes} de dados que estão acompanhando o \textit{byte} de estado. Caso este dispositivo receba outros valores, digamos: 200, 220 e 90. Ele saberá que os dois primeiros valores são \textit{bytes} de estados, enquanto o último é um \textit{byte} de dados que acompanha apenas o último \textit{byte} de estado, não ambos.


\section{Estrutura}
    \label{sec:estrutura}

        Este projeto procura considerar diversos quesitos, tais como resistência, momento, peso e tamanho do produto, além de manter os custos de produção o mais baixo possível. Para que isso fosse possível, decidiu-se projetar todos os componentes em uma ferramenta específica, podendo assim ser consideradas todas as variáveis para desenvolver um projeto de qualidade.

        Inicialmente, foram definidos os componentes terceirizados do projeto, para que então fosse possível dar início ao mesmo. Estes componentes são:

        \begin{figure}[H]
            \centering
            \begin{subfigure}[b]{.45\textwidth}
                \centering
                \includegraphics[scale=0.14]{Imagens/midi_shield1.png}
            	\caption[Shield MIDI]{Shield MIDI}
                \label{fig:shield-midi}
            \end{subfigure} %
            \begin{subfigure}[b]{.45\textwidth}
                \centering
                \includegraphics[scale=0.1]{Imagens/sliding_pot_b10k_montado.png}
            	\caption[Potenciômetro Linear]{Potenciômetro Linear}
            	\label{fig:linear-pot}
            \end{subfigure}

            \begin{subfigure}[b]{.45\textwidth}
                \centering
                \includegraphics[scale=0.1]{Imagens/potentiometer-10k-1.png}
            	\caption[Potenciômetro Rotatório]{Potenciômetro Rotatório}
            	\label{fig:rot-pot}
            \end{subfigure}
            \begin{subfigure}[b]{.45\textwidth}
                \centering
                \includegraphics[scale=0.1]{Imagens/arcade_button.png}
            	\caption[Botão Arcade]{Botão Arcade}
            	\label{fig:Arcade-button}
            \end{subfigure}

            \caption{Componentes terceirizados do projeto}
            \label{fig:componentes-terceirizados}
        \end{figure}


        Possuindo todas as medidas dos componentes, pôde-se planejar e desenhar o invólucro, utilizando a ferramenta SOLID WORKS \copyright. O material escolhido foi a madeira, devido ao seu baixo custo e de fácil manuseio. O desenho final da estrutura pode ser vista na Figura \ref{fig:involucro01}.

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.7]{Imagens/madeira0001.png}
        	\caption[Invólucro de madeira - Vista Superior]{Invólucro de madeira - Vista Superior}
        	\label{fig:involucro01}
        \end{figure}

        Considerando a estética, este protótipo foi projetado para uma simetria bilateral. Desta forma, 16 botões, 4 potenciômetros rotativos e 2 potenciômetros lineares foi a melhor combinação levando em consideração o microcontrolador escolhido, a complexidade do projeto e o custo do mesmo.

        Para a confecção do invólucro, foi contratado um serviço terceirizado. O resultado encontra-se na Figura \ref{fig:involucro02}. O produto fechado e pronto para uso encontra-se na figura \ref{fig:involucro03}.

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.15]{Imagens/0001.png}
        	\caption[Invólucro de madeira confeccionado]{Invólucro de madeira confeccionado}
        	\label{fig:involucro02}
        \end{figure}

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.15]{Imagens/x02.png}
        	\caption[Produto final]{Produto final}
        	\label{fig:involucro03}
        \end{figure}

\section{Sistema embarcado e estação base}
    \label{sec:embarcado}

        A parte elétrica do projeto pode ser compreendida através da figura~\ref{fig:diagrama-blocos}. O sistema embarcado gera sinais tanto para o shield MIDI quanto para o módulo bluetooth e estes se comunicam com suas respectivas plataformas (\textit{software} com interface MIDI e sistema operacional Android, respectivamente). Os botões e potenciômetros enviam as informações a serem interpretadas como comandos e transmitidas aos dispositivos.

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.6]{Imagens/diagrama-blocos.png}
        	\caption[Diagrama de blocos com a representação dos componentes do projeto]{Diagrama de blocos com a representação dos componentes do projeto}
        	\label{fig:diagrama-blocos}
        \end{figure}

        O sistema embarcado escolhido foi o Arduino Mega, pois ele possui um número suficiente de pinos de entrada saída digital para ligarmos um botão por pino, suprimindo assim a necessidade de uma configuração mais complexa para a ligação deles como, por exemplo, matriz ou multiplexação\cite{ArduinoRef2014}.

        A ligação entre os componentes externos (botões, potenciômetros, shield MIDI e módulo \textit{Bluetooth}) e o  sistema embarcado foi feita utilizando uma placa universal, com conectores MODU soldados nela e roteados com jumpers, desta maneira, não é preciso ligar diretamente estes componentes ao Arduino, o que tornou a montagem mais organizada e facilitou a correção de eventuais problemas. A ligação entre os componentes presos ao invólucro e a placa foi feita com o uso de cabos \textit{flat} (Figura~\ref{fig:cabos-flat}), confeccionados pela própria equipe. Para os cabos ligados aos botões, foram utilizados conectores do tipo \textit{faston} (Figura~\ref{fig:cabos-faston}), que se encaixavam adequadamente aos seus terminais. Para os potenciômetros, cabos \textit{flat} regulares de 3 vias foram usados, mas feitos de tal maneira que pudessem ser encaixados nos potenciômetros regulares, com ajuda de uma barra de pinos MODU neles soldada.

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.15]{Imagens/cabos-flat.jpg}
        	\caption[Cabos flat utilizados para conectar os botões às placas]{Cabos flat utilizados para conectar os botões às placas}
        	\label{fig:cabos-flat}
        \end{figure}

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.15]{Imagens/cabos-faston.jpg}
        	\caption[Conectores flats para serem conectados nos terminais dos botões]{Conectores flats para serem conectados nos terminais dos botões}
        	\label{fig:cabos-faston}
        \end{figure}

        Originalmente o roteamento entre os botões e o sistema embarcado seria feito utilizado uma placa de circuito impresso, cujo \textit{layout} foi feito com o \textit{software} Eagle (Figura~\ref{fig:pcb-eagle}), porém surgiram desafios na passagem do \textit{layout} do circuito impresso para a placa de cobre. Como o cronograma precisava ser seguido e problemas adicionais ainda podiam ocorrer, o projeto foi mudado para a utilização da placa universal. O layout confeccionado no Eagle foi utilizado como orientação para o local dos componentes a serem soldados na placa utilizada.

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.15]{Imagens/pcb-eagle.png}
        	\caption[Layout da placa de circuito impressa que seria confecctionada]{Layout da placa de circuito impressa que seria confecctionada}
        	\label{fig:pcb-eagle}
        \end{figure}

        Outro problema enfrentado foi o fato de ter sido confeccionado um invólucro com uma altura baixa para o projeto e os cabos para ligação dos botões à placa serem compridos, o que dificultou o fechamento do produto em si. Este problema foi mitigado colando os cabos à carcaça interna do produto para reduzir o comprimento deles que fica solto dentro da caixa. O resultado das ligações (sem os cabos \textit{flat}) pode ser visto na figura~\ref{fig:parte-eletrica}, um \textit{layout} organizado e simples de conectar os cabos e corrigir eventuais erros.

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.12]{Imagens/vista-interna-01.jpg}
        	\caption[Componentes e placas universais com conectores roteados]{Componentes e placas universais com conectores roteados}
        	\label{fig:parte-eletrica}
        \end{figure}

        O aplicativo foi desenvolvido para Android com a linguagem JAVA e consiste em apresentar funções básicas que um \textit{software} manipulador de áudio possui. Como um \textit{software} completo geraria grandes dificuldades quanto à manipulação de ondas e arquivos MIDI, decidiu-se em utilizar a estação base como um reprodutor de áudio, onde também seria possível trocar os efeitos utilizados. Portanto, o aplicativo somente recebe mensagens do arduino, sem a necessidade de respondê-las.

        A primeira tela, presente na figura~\ref{fig:mainview}, é responsável pela habilitação do \textit{Bluetooth} no dispositivo. Após estabelecida a conexão, o aplicativo reconhece mensagens MIDI enviadas pelo Arduino, reproduzindo um som pré-definido de acordo com o botão pressionado. Também é possível trocar efeitos de cada botão ao tocar em um deles na tela do aplicativo, como pode ser visto na figura~\ref{fig:connectedview}.

         \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.3]{Imagens/mainview.png}
        	\caption[Tela inicial do aplicativo - MainView]{Tela inicial do aplicativo - \textit{MainView}}
        	\label{fig:mainview}
        \end{figure}

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.3]{Imagens/connectedview.png}
        	\caption[Aplicativo conectado com o arduino]{Aplicativo conectado com o arduino}
        	\label{fig:connectedview}
        \end{figure}


\section{Algoritmos}
    \label{sec:algoritmo}

        A figura~\ref{fig:diagrama-classes} ilustra o diagrama de classes desenvolvido no começo do projeto, onde sua elaboração foi dada através do modelo MVC (\textit{Model-view-controller}). Dessa maneira, foram separadas classes responsáveis pelos dados (\textit{Model}), pelo controle dos dados (\textit{controller}) e pelo design do aplicativo (\textit{view}). As principais funções utilizadas estão contidas nas classes de controle, BtConnector e MidiController.

        Na primeira tela (\textit{MainView}), o reconhecimento entre o \textit{software} e o sistema microcontrolado é estabelecida com ajuda da classe JAVA \textit{BluetoothAdapter}. Essa classe auxilia na identificação dos dispositivos pareados com o Android que está sendo utilizado. Assim que um dispositivo pareado é selecionado, há a transição para a tela principal (\textit{ConnectedView}). Logo no início da criação dessa classe, uma conexão TCP entre o aplicativo e a estação base é estabelecida através de um \textit{BluetoothSocket}. Assim que a conexão é sucedida, o aplicativo cria uma \textit{thread} \textit{ConnectionListener} onde passa a esperar as mensagens do Microcontrolador. Cada mensagem recebida é transformada em \textit{string} e dividida em \textit{substrings} na classe \textit{MidiTranslator} para identificar qual botão foi pressionado e se o botão foi pressionado ou solto naquele momento, assim como uma mensagem MIDI.

        Para evitar \textit{delay} entre o pressionamento de um botão e a execução de um som, foi utilizado a classe JAVA \textit{Soundpool}. Ao mesmo tempo que o aplicativo tenta conectar-se com o arduino, sons previamente adicionados no aplicativo são carregados na memória para que a execução do som seja feita da maneira mais rápida possível\cite{JavaSound}. As classes responsáveis pelos efeitos não foram utilizadas no projeto por terem sido consideradas parte do aprimoramento e não do projeto em si.

        Para o arduino, as conexões MIDI e \textit{bluetooth} são iniciadas e os botões e potenciômetros são indentificados na inicialização\cite{Instructables03}. Ao entrar na função \textit{loop}, o arduino passa a esperar pelo pressionamento dos botões e ajustes dos potenciômetros. Isso é realizado através da leitura dos estados desses componentes através das funções \textit{digitalRead} e \textit{analogRead}, assim como o uso de condicionais para identificar quanto tempo estes foram pressionados.\cite{Instructables}

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.3]{Imagens/diagrama-classes.jpeg}
        	\caption[Diagrama de classes do aplicativo Android]{Diagrama de classes do aplicativo Android}
        	\label{fig:diagrama-classes}
        \end{figure}

         Por fim, no momento que o microcontrolador identifica o pressionamento de um botão, as funções \textit{MidiMessageToPC} e \textit{MidiMessageToMobile} são chamadas. Essas funções recebem um valor de \textit{status byte}, um de dados contendo
        qual botão foi pressionado e outro contendo o \textit{data byte}. O mesmo acontece com os potenciômetros, porém essas funções serão chamadas diversas vezes durante seu ajuste. As mensagens enviadas podem ser identificadas por qualquer \textit{software} que utilize MIDI.

        \begin{figure}[H]
        	\centering
        	\includegraphics[scale=0.8]{Imagens/diagrama-arduino.jpeg}
        	\caption[Funções do Arduino]{Funções do Arduino}
        	\label{fig:diagrama-arduino}
        \end{figure}






\section{Custos}

        Os custos do projeto realizado estão descritos na Tabela \ref{table:custos}.

        \begin{center}
            \tablefirsthead{%
              \hline
              \rowcolor{darkRed} \textcolor{white}{\textbf{Material}} & \textcolor{white}{\textbf{Especificação}} & \textcolor{white}{\textbf{Valor / un}} & \textcolor{white}{\textbf{Qtde}} & \textcolor{white}{\textbf{Valor Total}} \\
              \hline}
            \tablehead{%
              \hline
              \multicolumn{5}{|l|}{\small\sl continuação da página anterior} \\
              \hline
              \rowcolor{darkRed} \textcolor{white}{\textbf{Material}} & \textcolor{white}{\textbf{Especificação}} & \textcolor{white}{\textbf{Valor / un}} & \textcolor{white}{\textbf{Qtde}} & \textcolor{white}{\textbf{Valor Total}} \\
              \hline}
            \tabletail{%
              \hline
              \multicolumn{5}{|r|}{\small\sl continua na próxima página} \\
              \hline}
            \tablelasttail{\hline}
            \bottomcaption{Custos do projeto
            \label{table:custos}}
            %
            \renewcommand{\arraystretch}{1.5}%
            \begin{supertabular}{| C{3cm} | C{4cm} | C{1.5cm} | C{0.7cm} | C{1.5cm} |}
                \rowcolor{lightRed} Arduino & Arduino Uno R3 ATmega & \EUR{13.90} & 1 & R\$ 57.50 \\
                \rowcolor{white}    Saída MIDI & OLIMEX Shield-MIDI & \EUR{19.00} & 1 & R\$ 78.50 \\
                \rowcolor{lightRed} \textit{Bluetooth} & \textit{SunFounder Bluetooth} HC-06 RS232 & \EUR{8.99} & 1 & R\$ 37.20 \\
                \rowcolor{white}    Adaptador MIDI & Adaptador USB para Midi \textit{In-Out} & \EUR{7.70} & 1 & R\$ 34.00 \\
                \rowcolor{lightRed} Potenciômetro Linear & Potenciômetro Linear B10K & \EUR{0.33} & 8 & R\$ 11.00 \\
                \rowcolor{white}    Potenciômetro Deslizante & Potenciômetro Deslizante B10K & \EUR{1.17} & 2 & R\$ 9.75 \\
                \rowcolor{lightRed} Botão & Botão Interruptor ARCADE 24mm & R\$ 2.50 & 32 & R\$ 80.00 \\
                \rowcolor{white}    Envoltório Potenciômetro Linear & \textit{Potentiometer Drehknopf} 6mm & \EUR{0.33} & 8 & R\$ 11.00 \\
                \rowcolor{lightRed} Envoltório Potenciômetro Deslizante & \textit{Knob} para Potenciômetro 75mm & R\$ 1.50 & 2 & R\$ 3.00 \\
                \rowcolor{white}    Madeira & Chapa de madeira compensada 10mm & R\$ 8.00 & 2 & R\$ 16.00 \\
                \rowcolor{lightRed} Madeira & Chapa de madeira compensada 4mm & R\$ 2.00 & 4 & R\$ 8.00 \\
                \rowcolor{white}    Mão-de-Obra & Terceirizada & R\$ 126.00 & - & R\$ 126.00 \\
                \rowcolor{lightRed} Outros & Materiais para confecções dos cabos e das placas & -  & - & R\$ 50,00 \\
                \rowcolor{white} \multicolumn{4}{c}{\textbf{Total}} & R\$ 521.95 \\
            \end{supertabular}
        \end{center}

        Outros controladores MIDI podem ser encontrados no mercado na faixa de R\$400,00 a R\$500,00, porém estes possuem menos botões e funcionalidades que o projeto desenvolvido. Pode-se concluir que o custo do Dalle Pad é inferior ao de produtos similares.




\section{Considerações finais}
\label{sec:consideracoes}

    Ao final, tem-se uma estrutura funcional que apresenta todas as funcionalidades básicas que um músico precisa para editar e tocar músicas da maneira que desejar. O projeto apresenta compatibilidade com qualquer tipo de \textit{software} que utilize comunicação MIDI e apresentou um custo mais acessível se comparado com outros produtos similares presentes no mercado. A estação base consiste em um aplicativo de fácil manuseio, sendo que, assim que o mesmo conecta-se ao Dalle Pad, o usuário poderá tocar e mudar os efeitos de cada botão. Para trabalhos futuros, sugere-se aprimorar o \textit{software} para que este contemple as classes não utilizadas nesse projeto, como a classe \textit{Effects} que teria a função de adicionar efeitos para os áudios tocados. Também seria interessante desenvolver uma função para carregar sons presentes na nuvem ou no próprio celular, além daqueles presentes no aplicativo.




\section*{Agradecimentos}

    Primeiramente gostariamos de agradecer aos nossos amigos Cesar Figueiredo Lula e Jonas Ariel Berner, por nos ajudarem com ideias e auxilio técnico no desenvolvimento do projeto. Também agradecemos à Bollauf Marcenaria e Carpintaria pelo ótimo trabalho realizado com o invólucro e à UTFPR pela disponibilização dos laboratórios. Por fim, somos gratos pelos professores Gustavo Borba e Guilherme Schneider pelas diversas orientações no decorrer do projeto.

%Insere referencias [---
\bibliographystyle{unsrt}
\bibliography{reflatex} % Substituir pelo seu arquivo bib
% ---]

% ---]

\end{document} 